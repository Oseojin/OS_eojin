# PMM (Physical Memory Manager) - Bitmap 방식

## 1. 물리 메모리 관리의 개요
운영체제는 RAM을 효율적으로 나눠주어야 합니다. 물리 메모리 관리자(PMM)는 RAM을 **페이지 프레임(Page Frame)** 이라는 일정한 크기(보통 4KB)의 블록으로 나누어 관리합니다.

- **할당(Allocation):** 프로세스나 커널이 메모리를 필요로 할 때, 비어 있는 페이지 프레임 하나를 찾아 줍니다.
- **해제(Free):** 다 쓴 페이지 프레임을 회수하여 다시 비어 있는 상태로 만듭니다.

## 2. 비트맵(Bitmap) 알고리즘
가장 직관적이고 구현하기 쉬운 관리 방식입니다.

### 2.1. 개념
RAM의 각 페이지 프레임 하나당 **1비트(Bit)** 를 할당하여 상태를 표시합니다.
- **0:** 사용 가능 (Free)
- **1:** 사용 중 (Used)

예를 들어, 메모리가 12KB이고 페이지 크기가 4KB라면, 총 3개의 블록이 있습니다.
비트맵이 `101`이라면:
- 0번 블록(0~4KB): 사용 중
- 1번 블록(4~8KB): 비어 있음
- 2번 블록(8~12KB): 사용 중

### 2.2. 메모리 효율
페이지 크기가 4KB(4096 bytes)일 때, 1비트로 4096바이트를 관리하므로 오버헤드가 매우 적습니다.
- 4GB RAM 관리 시:
  - 블록 수 = 4GB / 4KB = 1,048,576개
  - 비트맵 크기 = 1,048,576 bits = 131,072 bytes = **128KB**
- 4GB를 관리하는 데 겨우 128KB만 있으면 됩니다.

## 3. 구현 전략

### 3.1. 초기화 (Initialization)
1. E820 메모리 맵을 통해 전체 메모리 크기를 파악합니다.
2. 비트맵 배열을 위한 메모리 공간을 확보합니다. (커널 뒤쪽 등 안전한 곳)
3. **기본 설정:** 모든 비트를 1(Used)로 설정합니다. (없는 메모리나 예약된 메모리를 잘못 쓰지 않도록)
4. **Free 설정:** E820 맵에서 'Usable'로 표시된 영역에 해당하는 비트만 0(Free)으로 바꿉니다.
5. **보호(Reserving):** 커널 코드, 비트맵 자체, 스택 등 이미 사용 중인 영역은 다시 1(Used)로 설정하여 할당되지 않도록 막습니다.

### 3.2. 할당 (Allocation)
1. 비트맵을 처음부터(또는 마지막 검색 위치부터) 탐색합니다.
2. 값이 0인 비트를 발견하면 1로 변경하고, `인덱스 * 4096` 주소를 반환합니다.
3. 끝까지 0이 없으면 OOM(Out of Memory)입니다.

### 3.3. 해제 (Free)
1. 해제할 주소를 입력받아 인덱스(`주소 / 4096`)를 계산합니다.
2. 해당 비트를 0으로 설정합니다.

## 4. 장단점
- **장점:** 구현이 단순하고, 메모리 오버헤드가 적습니다.
- **단점:** 할당 시 빈 공간을 찾기 위해 비트맵을 순차 탐색하므로, 메모리가 꽉 찰수록 검색 속도가 느려질 수 있습니다. (O(N))
